# api_sensors

This is the API to access the sensor metadata.

The underlying information is stored as information-per-sensor and
information-per-sensor-type.

Information returned for a single sensor (e.g. via `/get/`) is a JSON object as stored (and displayed on `acp_web`). API calls that
return data for multiple sensors will return a JSON object `{ "sensors": {....} }` where `{....}` is a dictionary of those sensors objects
with key `acp_id`.

## /get/<acp_id>/

The canonical "get" api call, returns the sensor metadata for sensor with id "<acp_id>".

The API will also lookup and return the sensor *type* metadata(if `acp_type_id` is present) as property `acp_type_info`.

Get the metadata for a given sensor (e.g. 'elsys-eye-048161'), including the type metadata (if it exists).

E.g. `/get/elsys-eye-048161/`.

```
{
  "acp_id": "elsys-eye-048161", 
  "acp_location": {
    "f": 0, 
    "system": "VLAB", 
    "x": 205, 
    "y": 113, 
    "zf": 1
  },
  "acp_ts": "1605719143.123", 
  "acp_type_id": "elsys-eye", 
  "acp_type_info": {....}
  "crate_id": "VLH1"
}
```
where the `acp_type_info` property is generated by the API as a result of the `acp_type_id` value in the sensor data.

For details of the `acp_type_info` information see the `/get_type/` API call below.

## /get_bim/<coordinate_system>/<crate_id>/

E.g. `/get_bim/WGB/FE11/`

Get sensors for a given `crate_id`, returning dictionary of sensors. This API call will *add* 
`acp_location_xyz` and `acp_boundary_xyz` properties to the sensor data.

```
{
  sensors: { "elsys-eye-048161": {
                                   ....
                                 }
              ....
           }
}
```

## /get_floor_number/<coordinate_system>/<floor_number>/

Similar to `/get_bim/` above, but return sensors found on a given *floor*. This relies upon the coordinate system being able
to translate the `acp_location` of the sensor into a floor number.

## /get_gps/

Get all sensors defined GPS location (i.e. `"acp_location": { "system": "GPS", ... }`)

In due course we'll add parameters to the API call e.g. to specify a lat/lng box.

## /get_type/<acp_type_id>/'

Get the metadata for a given sensor TYPE (e.g. 'elsys-eye')

```
{
  "acp_ts": "1597578643", 
  "acp_type_id": "elsys-eye", 
  "day_file": "/media/acp/mqtt_acp/sensors/<acp_id>/<YYYY>/<MM>/<acp_id>_<YYYY>-<MM>-<DD>.txt", 
  "description": "General purpose indoor enviromental sensor with 8x8 IR GridEye sensor.", 
  "feature_default": "temperature", 
  "features": {
    "humidity": {
      "jsonpath": "$.payload_cooked.humidity", 
      "name": "Humidity (Percent)", 
      "range": [
        0, 
        100
      ], 
      "short_name": "humidity", 
      "units": "percent"
    }, 
    "lux": {
      "jsonpath": "$.payload_cooked.light", 
      "name": "Light level (lux)", 
      "range": [
        0, 
        600
      ], 
      "short_name": "lux", 
      "units": "lux"
    }, 
    "motion": {
      "jsonpath": "$.payload_cooked.motion", 
      "name": "Motion", 
      "range": [
        0, 
        5
      ], 
      "short_name": "motion", 
      "units": "0..255 motion counts"
    }, 
    "temperature": {
      "jsonpath": "$.payload_cooked.temperature", 
      "name": "Temperature (Celsius)", 
      "range": [
        -10, 
        40
      ], 
      "short_name": "temp", 
      "units": "celsius"
    }, 
    "vdd": {
      "jsonpath": "$.payload_cooked.vdd", 
      "name": "Battery millivolts", 
      "range": [
        3000, 
        4000
      ], 
      "short_name": "vdd", 
      "units": "millivolts"
    }
  }, 
  "link": "https://elsys.se/public/datasheets/ERS_Eye_datasheet.pdf", 
  "name": "Elsys Eye", 
  "notes": "https://elsys.se/public/datasheets/ERS_Eye_datasheet.pdf", 
  "short_name": "Elsys Eye"
}
```

## /list/[?type_metadata=true]

(Still in development) Return a list of sensors

We intend to support querystring filters e.g. '?feature=temperature'. Currently the API call returns *all* the sensors.

Return dictionaries of sensors and metadata

```
{ sensors: {....}, 
  types: {....}
}
```

## /list_types/

(Still in development) Return a list of sensor types (currently all)

We could support querystring filters e.g. '?feature=temperature'

Returns { types: { "elsys-ems": {...}, ... }}
